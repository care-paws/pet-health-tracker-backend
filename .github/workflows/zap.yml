name: DAST Security Scan  
on:  
  workflow_run:  
    workflows: ["Deploy to Render"]  
    types:  
      - completed  
  
jobs:  
  zap-scan:  
    runs-on: ubuntu-latest  
    if: ${{ github.event.workflow_run.conclusion == 'success' }}  
    steps:  
      - name: Checkout  
        uses: actions/checkout@v4
        
      - name: Wait for deployment  
        run: sleep 60  
          
      - name: ZAP Full Scan  
        uses: zaproxy/action-full-scan@v0.13.0  
        with:  
          token: ${{ secrets.GITHUB_TOKEN }}  
          docker_name: 'ghcr.io/zaproxy/zaproxy:stable'  
          target: 'https://pet-health-tracker-backend.onrender.com'
          rules_file_name: '.zap/rules.tsv'  
          cmd_options: '-a -m 5'  
            
      - name: Upload ZAP Report  
        uses: actions/upload-artifact@v3  
        if: always()  
        with:  
          name: zap-report  
          path: report_html.html